<!doctype html>
<html lang="en">
  <head>
    {% block head %}
    <title>{% block title %} Bienvenido {% endblock %}</title>
    {% endblock %}
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
    
    <!-- En todas las imagenes la ruta ya no es ../static/imagen , si no que es: /static/imagen -->
    <!--Para los mapas de la practica 8 tengo que añadir esto-->
    <!-- PARA LOS MAPAS-->
    <link rel="stylesheet" href="https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.3.0/css/ol.css" type="text/css">
    <script src="https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.3.0/build/ol.js"></script>
    
    
    
<style>
  .map {
    height: 400px;
    width: 100%;
  }
</style>

    {% load static %} 
        <!-- <link  href="{% static 'estilo.css' %}" rel="stylesheet" media="screen">
        <script src="{% static 'js/jquery-3.3.1.min.js'%}"></script> -->
        <script src="{% static 'js/funciones.js'%}"></script>
        
    <meta charset="UTF-8">
    
</head> 
<body>
  
  <legend>MAPA DE GRANADA:</legend>
                <!-- <p id="Cord">{{coord}}</p> -->
                <div style="margin-left: auto; margin-right: auto;  max-width:48%; flex: auto;" class="col-xl-4 col-lg-5">
                  <h1 class="h3 mb-2 text-gray-800">Mapa</h1>
                        <div id="map" class="map"></div>
                        <div id="popup" class="ol-popup">
                          <a href="#" id="popup-closer" class="ol-popup-closer"></a>
                          <div id="popup-content"></div>
                        </div>
                        
                        <script type="text/javascript">
                          var lon = "{{longuitud}}"; //[-73.8786113 , quito el [
                          var lat = "{{latitud}}";//40.8502883] , quito el ]
                          var radio= "{{radio}}" 
                    
                          var map = new ol.Map({
                            target: 'map',
                            layers: [
                              new ol.layer.Tile({
                                source: new ol.source.OSM()
                              })
                            ],
                            view: new ol.View({
                              center: ol.proj.fromLonLat([-3.59, 37.18]), //Esto es para centrar el mapa en las coordenanadas que tu quieras poner a mano, pk todos los restaurantes estan en nueva york
                              zoom: 9
                            })
                          });
                          

                          

                        add_map_point(lon,lat,radio);
                        
                        var container = document.getElementById('popup');
                        var content = document.getElementById('popup-content');
                        var closer = document.getElementById('popup-closer');

                        

                        var overlay = new ol.Overlay({
                          element: container,
                          autoPan: true,
                          autoPanAnimation: {
                            duration: 250
                          }
                        });
                        
                        map.addOverlay(overlay);
                        closer.onclick = function() {
                          overlay.setPosition(undefined);
                          closer.blur();
                          return false;
                        };

                        

                        map.on('singleclick', function(evt) {
                          var coordinate = evt.coordinate;
                          var hdms = ol.proj.transform(evt.coordinate, 'EPSG:3857', 'EPSG:4326');
                          content.innerHTML = '<code>' + hdms +
                              '</code>';
                          overlay.setPosition(coordinate);
                          if (map.getLayers().getLength() > 1) {
                            map.getLayers().pop();
                          }
                          var vectorLayer = new ol.layer.Vector({
                          source:new ol.source.Vector({
                          features: [new ol.Feature({
                          geometry: new ol.geom.Point(ol.proj.transform([parseFloat(hdms[0]), parseFloat(hdms[1])], 'EPSG:4326', 'EPSG:3857')), // Esas cordenadas se las pongo a mano, que es donde estan todos los restaurantes, en NEW YORK,ojo con el orden de lat y lng
                          })]
                          }),
                          style: new ol.style.Style({
                          image: new ol.style.Icon({
                          anchor: [0.5, 0.5],
                          anchorXUnits: "fraction",
                          anchorYUnits: "fraction",
                          src: "https://upload.wikimedia.org/wikipedia/commons/e/ec/RedDot.svg"
                          })
                          })
                          });

                  
                          map.addLayer(vectorLayer);
                        });
                        </script>
                   
                   
                    <!-- <iframe width="425" height="350" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="https://www.openstreetmap.org/export/embed.html?bbox=-3.6276394128799443%2C37.1949759077155%2C-3.618680834770203%2C37.19880460126361&amp;layer=mapnik" style="border: 1px solid black"></iframe><br/><small><a href="https://www.openstreetmap.org/#map=18/37.19689/-3.62316">Ver mapa más grande</a></small> -->
                </div>
              
     
</body>
</html>